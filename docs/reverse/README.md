# Negaboku 技術設計文書（逆生成）

## 概要

このディレクトリには、実装済みのGodotプロジェクト「願い石と僕たちの絆」から逆生成された技術設計文書が含まれています。Unity版からGodot版への完全移行プロジェクトの設計情報を包括的に記録しています。

## 生成日時
2025-01-05 01:00:00

## 文書一覧

### 📋 [negaboku-architecture.md](./negaboku-architecture.md)
**アーキテクチャ設計書**
- Scene + Node + Signal駆動アーキテクチャの詳細
- 技術スタック（Godot 4.x + GDScript）
- レイヤー構成とデザインパターン
- パフォーマンス最適化実績（98%軽量化・90%高速化）

### 🔄 [negaboku-dataflow.md](./negaboku-dataflow.md)
**データフロー設計書**
- ゲームフローとユーザー操作の流れ
- 関係値システムのSignal連鎖
- バトルシステムのターン制処理
- マークダウンシナリオの読み込みフロー
- エラー処理・フォールバック機能

### ⚙️ [negaboku-systems.md](./negaboku-systems.md)
**システム仕様書**
- 関係値システム詳細仕様（5段階関係値管理）
- バトルシステム詳細仕様（関係値連動スキル）
- シナリオシステム（マークダウン駆動）
- UI管理・デバッグシステム
- セーブ・ロード機能

### 💻 [negaboku-interfaces.gd](./negaboku-interfaces.gd)
**GDScript型定義集約**
- 全システムのクラス定義
- enum・Signal・データ構造
- エラー処理・パフォーマンス最適化型
- 設定管理・プラットフォーム対応型

## プロジェクト実装状況

### ✅ 完全実装済みシステム

#### コアゲームシステム
- **関係値システム**: 5段階関係値管理（-25〜100）
- **バトルシステム**: ターン制戦闘+関係値連動スキル
- **シナリオシステム**: マークダウン駆動テキスト表示
- **2人パーティ固定**: 濃密な関係性構築

#### 技術基盤システム
- **Scene+Node+Signal**: Godot標準アーキテクチャ
- **AutoLoad管理**: GameManagerによる統合制御
- **統合デバッグ機能**: リアルタイム関係値操作
- **セーブ・ロード**: JSON形式データ永続化

#### UI・UXシステム
- **DialogueBox**: タイピング効果付きテキスト表示
- **ChoicePanel**: 動的選択肢生成・条件判定
- **EffectLayer**: パーティクル・フラッシュ・カメラ揺れ
- **ログ機能**: 会話履歴管理

#### クロスプラットフォーム対応
- **Windows・Mac・Linux**: ネイティブマルチプラットフォーム
- **統一コードベース**: プラットフォーム固有コード不要
- **自動最適化**: Godotエンジンレベル最適化

### 📊 パフォーマンス実績

| 項目 | Unity版 | Godot版 | 改善率 |
|------|---------|---------|--------|
| **ファイルサイズ** | 500MB | 10MB | **98%削減** |
| **起動時間** | 15-30秒 | 1-3秒 | **90%高速化** |
| **メモリ使用量** | 200-400MB | 50-100MB | **75%削減** |

## 分析手法

### 🔍 実装されたアーキテクチャの解析
1. **ディレクトリ構造解析**: 27個のGDScriptファイル、12個のシーンファイル
2. **Signal通信解析**: 25個のSignal定義、イベント駆動フロー
3. **クラス継承解析**: Node/Control/Resource継承パターン
4. **データフロー追跡**: ユーザー入力→関係値変更→UI更新の流れ

### 📁 解析対象ファイル
```
GodotProject/Scripts/
├── systems/ (8ファイル)
│   ├── relationship.gd          # 関係値システム
│   ├── battle_system.gd         # バトルシステム
│   ├── markdown_parser.gd       # マークダウン解析
│   └── scenario_loader.gd       # シナリオ読み込み
├── ui/ (15ファイル)
│   ├── dialogue_box.gd          # ダイアログボックス
│   ├── choice_panel.gd          # 選択肢パネル
│   └── working_text_scene.gd    # テキストシーン統合
└── core/ (4ファイル)
    ├── game_manager.gd          # ゲーム統合管理
    └── character.gd             # キャラクターリソース
```

## 設計思想・原則

### 🎯 Godot文化の尊重
- **Scene/Node階層**: 機能別の明確なシーン分割
- **Signal通信**: 疎結合なイベント駆動システム
- **Resource活用**: データ定義の型安全性確保
- **AutoLoad管理**: グローバルシステム統合

### 🔧 開発効率化
- **統合デバッグ駆動開発**: リアルタイムテスト環境
- **高速プロトタイピング**: GDScriptによる迅速実装
- **Tidy First原則**: 新機能前の既存コード整理
- **継続的改善**: 即時フィードバック環境

### 🎮 ゲーム特化設計
- **関係値重視**: パーティ間関係性が戦闘・物語に直結
- **選択肢ベース探索**: マップ移動なし、選択肢でダンジョン進行
- **マークダウン駆動シナリオ**: テキストベースシナリオ記述
- **拡張性確保**: DLCキャラ対応、カスタマイズ機能

## 非機能要件の実装

### 🔒 品質・保守性
- **型ヒント活用**: GDScriptの型安全性確保
- **エラー処理統一**: push_error()によるエラー通知
- **フォールバック機能**: 読み込み失敗時のデフォルト動作
- **適度な抽象化**: Godot標準パターン準拠

### ⚡ パフォーマンス最適化
- **Object Pool**: エフェクトオブジェクト再利用
- **キャッシュシステム**: 頻繁アクセスデータの高速化
- **Signal管理**: 不要な接続の適切な解除
- **メモリ効率**: 75%メモリ使用量削減達成

## 開発環境・ツール

### 🛠️ 必要環境
- **Godot**: 4.3以上（軽量・高速・マルチプラットフォーム）
- **開発環境**: Godot Editor（統合開発環境）
- **言語**: GDScript（高速プロトタイピング）
- **バージョン管理**: Git

### 🎮 実行方法
```bash
# Godot Editorでプロジェクトを開く
1. Godot 4.3以上をダウンロード・インストール
2. GodotProject/project.godot を開く
3. MainMenu.tscnを実行（F5キー）
4. 「新規ゲーム」→ WorkingTextScene で動作確認
```

## 今後の拡張計画

### 📈 Phase 1: 完了済み
- ✅ 基盤アーキテクチャ構築（TDD）
- ✅ コアシステム実装（DDD）
- ✅ アプリケーション層構築
- ✅ プレゼンテーション層とクロスプラットフォーム対応

### 🚀 Phase 2: 計画中
- DLCキャラクター追加（リラ・ケンゴ・ピクス）
- 研究所ダンジョン実装
- AI救済ルート追加
- 多言語対応（英語・中国語）

### 🎯 Phase 3: 将来計画
- モバイル対応（Android・iOS）
- Web対応（HTML5 Export）
- コンソール対応検討
- VR/AR対応検討

## ライセンス・権利情報

### 📜 非商用ライセンス
- **利用制限**: 非商用利用限定
- **教育・学習**: 個人学習と教育機関での使用推奨
- **オープンソース貢献**: 改変と再配布は同ライセンス下で許可
- **帰属表示**: 原作者クレジットとライセンス表示必要

## 関連文書

### 📚 プロジェクト文書
- [CLAUDE.md](../../CLAUDE.md): プロジェクト開発ガイドライン
- [docs/development-scope.md](../development-scope.md): 開発範囲・実装状況
- [docs/architecture-design.md](../architecture-design.md): Godot設計指針
- [docs/implementation-guidelines.md](../implementation-guidelines.md): GDScript実装規約

### 🔄 Unity移行記録
- [GodotProject/UNITY_TO_GODOT_MAPPING.md](../../GodotProject/UNITY_TO_GODOT_MAPPING.md): Unity→Godot移行対応表

---

**この逆生成文書は実装済みGodotプロジェクトの完全な技術仕様を記録し、「願い石と僕たちの絆」の関係値重視型RPGアーキテクチャを後世に伝えるものです。**