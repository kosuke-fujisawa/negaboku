# ゲームシステム仕様書

> **🎮 ゲームの核**: 関係値システムを中心とした「僕たちの絆」を紡ぐ関係値RPG

## 1. 基本構造とプレイスタイル

- **ジャンル**: ストーリー重視型 RPG（ノベル的要素あり）
- **プレイ視点**: キャラクターごとのルート分岐あり（全員仲良しルート含む）
- **バトル形式**: ターン制コマンドバトル
- **戦闘人数**: プレイヤーキャラは 2 人、敵も基本 2 体で編成

## 2. バトルシステム

### 2.1. ターン制バトル構造

#### 味方ユニット
- 2 人組で行動
- 1 ターンに各キャラが 1 回行動
- 回復や蘇生（「げんきのかけら」等）も 1 人で実施可

#### 敵ユニット（中ボス想定）
- 無機質な 2 体構成
- **敵A**: 命中率バフ、状態異常バフなどサポート特化
- **敵B**: 火力型、命中が低いが必中化されると大ダメージ
- **行動パターンに連携あり**:
  - A が命中 UP → B が高火力必中攻撃
  - A が状態異常成功率 UP → B が全体異常技
- 中ボスながら演出・連携に重点

### 2.2. バフ・デバフの構造

| 効果種類 | 内容例 |
| :--- | :--- |
| **攻撃バフ** | 味方or敵の攻撃力を上昇 |
| **命中率バフ** | 次ターンの命中率を一時的に上昇させる |
| **状態異常強化バフ** | 状態異常の成功確率を上げる（敵Aが使用） |
| **状態異常** | スタン、混乱など（全体技での付与も存在） |

### 2.3. 技・行動の分類

| 技カテゴリ | 内容例 |
| :--- | :--- |
| **通常攻撃** | 味方・敵ともに標準装備 |
| **高火力技** | 命中率が低いが、バフで必中化されると強力 |
| **状態異常技** | スタン、毒、混乱など（全体対象含む） |
| **バフ系スキル** | 味方全体の攻撃力UP、状態異常耐性UPなど |
| **回復・蘇生スキル** | HP回復、気絶からの蘇生（アイテム使用含む） |

### 2.4. パラメータ管理

- **HP（ヒットポイント）**: 生命力、0 になると戦闘不能
- **MP（マジックポイント）**: 魔法スキル使用時に消費
- **SP（スペシャルポイント）**: 共闘技・対立技専用ポイント、戦闘ごとに初期化

### 2.5. 難易度設計の方針

- 雑魚戦よりも「中ボスの知的連携」に重点
- 敵 AI が戦術的であることを演出し、システム的にも対応を迫られる設計
- 状態異常や命中率を巡る駆け引きを重視

### 2.6. プレイヤーの思考誘導

- あえて「2 人で戦う」シンプルさを軸に、連携やバフの意味を自然と学べる設計
- 敵の連携行動を観察し、自分たちの行動順やスキルを組み合わせて対抗する形

## 3. 関係値システム

### 3.1. 基本仕様
関係値は-100～+100 の数値で管理され、UI 上で常時表示されます：

- **親密（+50以上）**: 共闘技が解放、高威力＋追加効果
- **通常（-49～+49）**: 標準的な相互作用、基本スキルのみ使用可能
- **対立（-50以下）**: 対立技が解放、ハイリスクハイリターン（主にソウマ限定）

### 3.2. スキル分類システム（関係値連動）

#### 通常スキル（白）
- **解放条件**: 常時使用可能
- **消費**: HP・MP のみ
- **効果**: 基本的な攻撃・回復スキル

#### 魔法スキル（青）
- **解放条件**: 常時使用可能
- **消費**: MP（マジックポイント）
- **効果**: 属性攻撃・状態異常・高度な回復

#### 共闘技（緑）
- **解放条件**: 関係値 ≧ +50（親密状態）
- **消費**: SP（スペシャルポイント）
- **効果**: 高威力攻撃＋追加効果、協力によるコンボ技
- **特徴**: 共闘技なしだとやや困難な難易度設定

#### 対立技（赤）
- **解放条件**: 関係値 ≦ -50（対立状態）、対象ペアのみ
- **消費**: SP（スペシャルポイント）
- **効果**: ハイリスクハイリターン、一部は高火力だが運用困難
- **特徴**: 主にソウマ限定の特殊戦術

### 3.3. 関係値変動

- **戦闘掛け合い成功**: +1（スキル発動時の協力行動）
- **掛け合い失敗**: -1（連携ミス・意見対立）
- **イベント選択肢**: ±25～±100 の大幅変動
- **ギミック時**: 変動なし（謎解きは関係性に影響せず）
- **仲間同士ペア**: 変動値固定（選択肢なし、イベントのみ発生）

### 3.4. キャップ制とルート確定

- **序盤キャップ**: ±30（深い関係になりすぎない自然な開始）
- **中盤キャップ**: ±50（章進行で共闘技解放レベル）
- **終盤キャップ**: ±100（オーブ獲得で完全解放、全ルート分岐可能）
- **ルート確定**: ゲーム後半の特定イベントで、その時点の関係値（親密/通常/対立）によりエンディングルートが分岐。一度確定したルートは変更不可。

## 4. 推奨ペア（特別イベント・エンディングCGあり）

### 主人公（ソウマ）系
- **ソウマ × ユズキ**: 幼馴染の絆、王道ルート
- **ソウマ × レツジ**: 親友の信頼、男同士の絆
- **ソウマ × カイ**: 対立から親密への変化（初期-25）
- **ソウマ × リラ**:（DLC）AI 少女との特別な絆

### その他の推奨ペア
- **レツジ × ユズキ**: 戦士と白魔術師の協力
- **レツジ × リゼル**: 戦士と召喚術師の協力
- **ユズキ × カイ**: 幼馴染とチャラ男の関係
- **マキト × セリーヌ**: 博識とお嬢様の組み合わせ
- **カイ × ピクス**:（DLC）チャラ男とインプのコンビ
- **カイ × セリーヌ**: 身分差を超えた関係
- **セリーヌ × リラ**:（DLC）お嬢様と AI 少女の絆
- **ケンゴ × リラ**:（DLC）父と AI の特別な関係
- **マキト × ピクス**:（DLC）新組み合わせ

### 対立ペア（特別仕様）
- **ソウマ × カイ**: 価値観不一致、特殊対立技あり
- **ユズキ × セリーヌ**: 三角関係、恋愛的嫉妬
- **レツジ × ケンゴ**:（DLC）過去の事件による対立

## 5. プレゼント機能

- **役割**: 戦闘・イベントでの変動がメイン、プレゼントは補助
- **用途**: 関係値を微調整するためのサブ要素
- **タイミング**: 拠点での自由アクション、ダンジョン進行に影響なし
- **効果幅**: 好物(+10), 普通(+5), 嫌い(-5)
- **情報開示**: 相手のリアクションや特定キャラのヒントで判明。プレイヤーの観察と学習を促す。

## 6. ダンジョンとストーリー進行

### 6.1. 進行システム

- **選択肢ベース進行**: 伝統的なマップ移動ではなく選択肢で進行
- **ストーリー駆動**: イベントと関係値が進行に影響
- **リプレイ性**: 2 回目以降はギミックをスキップ可能

### 6.2. ダンジョン構成（体験版）

7 層構造で、自由選択、ギミック、強制戦闘、イベントを組み合わせる。

1. **自由選択**
2. **ギミック1**
3. **強制戦闘**
4. **初回イベント**
5. **ギミック2**
6. **強制戦闘**
7. **ボス戦**

### 6.3. イベント仕様

- **選択肢**: 主人公（ソウマ）操作時のみ表示され、関係値が大幅に変動(±25～±100)。
- **仲間同士ペア**: 固定テキストで関係値変化のみ（選択肢なし）。

## 7. その他の設計補足

- **蘇生アイテムの演出**: シナリオ的にも、仲間を信じて立ち上がらせるような温度感を大事に
- **AI設計・サポート利用**: 実装レイヤーは AI（Claude など）に委任して進行
- **コンセプト**:「キャラクターに嘘をつかせない」「誠実な戦闘と物語体験」

---

## ゲームシステム仕様（Rust + Bevy実装）

### 実装完了システム ✅
- **タイトル画面**: Camera2d + Text2d による基本 UI 表示
- **テキストタイピング**: DialogueText コンポーネントによる 1 文字ずつ表示
- **背景切替**: BackgroundController による色ベース背景変更
- **入力システム**: Bevy の標準 InputSystem 活用
- **状態管理**: Resource + Component ベースの軽量状態管理

### パーティシステム（実装予定）
- **固定2人編成**: 深い関係性の構築に特化
- **初期設定**: 最初の 2 キャラクターで自動編成
- **編成制限**: 必ず 2 人での編成が必要

### 関係値システム（3段階）（実装予定）
- **関係レベル**:
  - **親密**: 共闘技が解放、高威力＋追加効果
  - **通常**: 標準的な相互作用、基本スキルのみ使用可能
  - **対立**: 対立技が解放、ハイリスクハイリターン（主にソウマ限定）
- **数値管理**: 内部で数値管理、UI で静かに表示
- **推奨ペア**: 専用イベント・エンディング・カットイン有り
- **Rust実装**: `src/domain/relationship.rs`

### バトルシステム（実装予定）
- **ターン制戦闘**: 明確な戦術選択と結果予測
- **関係値連動**: ダメージ修正・スキル発動条件
- **AI行動**: シンプルな AI 敵行動パターン
- **Rust実装**: `src/domain/battle.rs` + ECS システム

### UIシステム（部分実装済み）
- **テキストタイピング**: bevy_ui + Component ベース ✅
- **背景システム**: Sprite + Color による背景制御 ✅
- **選択肢システム**: 条件判定付き動的選択肢（実装予定）
- **エフェクト**: パーティクル・フラッシュ・カメラ揺れ（実装予定）
